version: "3.9"

################################################################################

services:
  latest:
    # runtime: nvidia
    gpus: all
    build:
      context: .
      dockerfile: ${TAG_NAME}/Dockerfile
    image: ${USER}/lerobot:${TAG_NAME}
    container_name: ${USER}_lerobot
    network_mode: host
    privileged: true
    shm_size: '50gb'
    volumes:
      - ${PWD}/../../:/root/lerobot
      - ${DATASETS_PATH}:/root/datasets
      - /tmp/.x11-unix:/tmp/.x11-unix
      # - /home/robo/livox_ws/src:/root/livox_ws/src
      - /home/robo/catkin_ws/src:/root/catkin_ws/src
      - /home/robo/catkin_ws/src:/root/catkin_ws/src
      - /home/robo/catkin_ws/bin:/root/catkin_ws/bin
      - /home/robo/catkin_ws/bag:/root/catkin_ws/bag
      - /tmp/.X11-unix:/tmp/.X-unix
      - /dev:/dev
    environment:
      - DISPLAY=${DISPLAY}
      - QT_X11_NO_MITSHM=1
      - WANDB_API_KEY=${WANDB_API_KEY}
      # Hack with HDF5 file locking
      - HDF5_USE_FILE_LOCKING=FALSE
      # For debugging with Hydra
      - HYDRA_FULL_ERROR=1
    command: /root/lerobot/docker/initialize-docker-container.sh

 